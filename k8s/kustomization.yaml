# Apply all Kubernetes manifests in order
# Usage: kubectl apply -f kustomization.yaml

apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: agentic-qa

resources:
  # Infrastructure
  - namespace.yaml
  - config.yaml
  - redis.yaml
  - rabbitmq.yaml
  
  # QA Manager
  - qa-manager.yaml
  
  # QA Agents (Group 1)
  - qa-agents-1.yaml
  
  # QA Agents (Group 2)
  - qa-agents-2.yaml
  
  # QA Agents (Group 3)
  - qa-agents-3.yaml
  
  # WebGUI
  - webgui.yaml
  
  # Optional: Ingress for external access
  - ingress.yaml

# Common annotations for all resources
commonAnnotations:
  deployment-date: "{{ date }}"
  managed-by: "kustomize"

# Common labels for all resources
commonLabels:
  app.kubernetes.io/name: "agentic-qa"
  app.kubernetes.io/component: "qa-system"
  app.kubernetes.io/managed-by: "kustomize"

# Patches for specific configurations
patchesStrategicMerge:
  - |-
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: webgui
    spec:
      template:
        spec:
          containers:
          - name: webgui
            env:
            - name: NODE_ENV
              value: "production"