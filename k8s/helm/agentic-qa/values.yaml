# Default values for agentic-qa chart.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Global configuration
global:
  imageRegistry: ""
  imagePullSecrets: []
  storageClass: ""

# Image configuration
image:
  registry: docker.io
  repository: agentic-qa
  pullPolicy: IfNotPresent
  tag: "2026.2.16"

# Common annotations and labels
commonLabels: {}
commonAnnotations: {}

# Namespace configuration
namespace:
  create: true
  name: "agentic-qa"

# Secrets configuration (base64 encoded values)
secrets:
  openaiApiKey: ""  # Set via --set secrets.openaiApiKey=$(echo -n "your-key" | base64)
  rabbitmqPassword: "Z3Vlc3Q="  # "guest" in base64
  # Plain text password used in RABBITMQ_URL construction at template render time.
  # Must match the base64-decoded value of rabbitmqPassword above.
  rabbitmqPasswordPlain: "guest"

# Infrastructure services
redis:
  enabled: true
  replicaCount: 1
  image:
    repository: redis
    tag: "7-alpine"
  service:
    port: 6379
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  persistence:
    enabled: true
    size: 1Gi

rabbitmq:
  enabled: true
  replicaCount: 1
  image:
    repository: rabbitmq
    tag: "3-management-alpine"
  auth:
    username: guest
  service:
    amqpPort: 5672
    managementPort: 15672
  resources:
    requests:
      memory: "512Mi"
      cpu: "500m"
    limits:
      memory: "1Gi"
      cpu: "1"
  persistence:
    enabled: true
    size: 2Gi

# QA Agents configuration (6 agents)
agents:
  qaManager:
    enabled: true
    replicaCount: 1
    resources:
      requests:
        memory: "1Gi"
        cpu: "1"
      limits:
        memory: "2Gi"
        cpu: "2"
    healthPort: 8001

  seniorQa:
    enabled: true
    replicaCount: 1
    resources:
      requests:
        memory: "1.5Gi"
        cpu: "1"
      limits:
        memory: "3Gi"
        cpu: "2"
    healthPort: 8002

  juniorQa:
    enabled: true
    replicaCount: 1
    resources:
      requests:
        memory: "1Gi"
        cpu: "750m"
      limits:
        memory: "2Gi"
        cpu: "1500m"
    healthPort: 8003

  qaAnalyst:
    enabled: true
    replicaCount: 1
    resources:
      requests:
        memory: "1Gi"
        cpu: "750m"
      limits:
        memory: "2Gi"
        cpu: "1500m"
    healthPort: 8004

  securityCompliance:
    enabled: true
    replicaCount: 1
    resources:
      requests:
        memory: "1Gi"
        cpu: "750m"
      limits:
        memory: "2Gi"
        cpu: "1500m"
    healthPort: 8005

  performance:
    enabled: true
    replicaCount: 1
    resources:
      requests:
        memory: "1.5Gi"
        cpu: "1"
      limits:
        memory: "3Gi"
        cpu: "2"
    healthPort: 8006

# WebGUI configuration
webgui:
  enabled: true
  replicaCount: 1
  resources:
    requests:
      memory: "512Mi"
      cpu: "500m"
    limits:
        memory: "1Gi"
        cpu: "1"
  service:
    type: LoadBalancer
    port: 8000
    targetPort: 8000

# Ingress configuration
ingress:
  enabled: false
  className: "nginx"
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
  host: "qa.yourdomain.com"
  tls:
    enabled: false
    secretName: "agentic-qa-tls"

# Environment configuration
env:
  REDIS_HOST: "redis-service"
  REDIS_PORT: "6379"
  REDIS_DB: "0"
  RABBITMQ_HOST: "rabbitmq-service"
  RABBITMQ_PORT: "5672"
  RABBITMQ_USER: "guest"
  RABBITMQ_VHOST: "/"
  WEBGUI_HOST: "0.0.0.0"
  WEBGUI_PORT: "8000"
  PRIMARY_MODEL_PROVIDER: "openai"
  ENABLE_SELF_HEALING: "true"
  ENABLE_FUZZY_VERIFICATION: "true"
  ENABLE_RISK_BASED_PRIORITIZATION: "true"
  ENABLE_CONTEXT_AWARE_TESTING: "true"
  LOG_LEVEL: "INFO"
  PYTHONPATH: "/app"

# Pod security context
podSecurityContext:
  fsGroup: 1000

# Container security context
securityContext:
  allowPrivilegeEscalation: false
  runAsNonRoot: true
  runAsUser: 1000
  readOnlyRootFilesystem: true
  capabilities:
    drop:
    - ALL
  seccompProfile:
    type: RuntimeDefault

# Service account configuration
serviceAccount:
  create: true
  annotations: {}
  name: ""

# Node selector and tolerations
nodeSelector: {}
tolerations: []
affinity: {}

# Autoscaling (HorizontalPodAutoscaler)
autoscaling:
  enabled: true
  minReplicas: 1
  maxReplicas: 3
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80
  juniorQaMaxReplicas: 5
  webguiMaxReplicas: 5

# Network policies (restricts inter-pod traffic to only what is needed)
networkPolicy:
  enabled: true

# Pod Disruption Budgets (ensures at least one pod remains during node drains)
podDisruptionBudget:
  enabled: true
  minAvailable: 1

# Namespace-level resource quotas
resourceQuota:
  enabled: false  # Enable in production to cap total cluster resource usage
  requests:
    cpu: "16"
    memory: "32Gi"
  limits:
    cpu: "32"
    memory: "64Gi"
  pods: "20"
  services: "20"
  secrets: "20"
  configmaps: "20"
  persistentvolumeclaims: "10"

# Startup probe configuration
startupProbe:
  enabled: true
  initialDelaySeconds: 10
  periodSeconds: 10
  failureThreshold: 30
  timeoutSeconds: 3
