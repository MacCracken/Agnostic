<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ report.title }} - Report</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/reports.css" rel="stylesheet">
</head>
<body>
    <div class="report-container">
        <!-- Report Header -->
        <header class="report-header">
            <h1 class="report-title">{{ report.title }}</h1>
            <p class="report-subtitle">Session ID: {{ report.session_id }}</p>
            <p class="report-subtitle">Generated: {{ report.generated_at }}</p>
            {% if report.overview %}
            <p class="report-subtitle">{{ report.overview.session_title }}</p>
            {% endif %}
        </header>

        <!-- Executive Summary -->
        {% if report.overview %}
        <section class="section">
            <h2 class="section-title">Overview</h2>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value">{{ report.overview.duration }}</div>
                    <div class="metric-label">Duration</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">{{ report.overview.agents_deployed }}</div>
                    <div class="metric-label">Agents Deployed</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">{{ report.overview.overall_score }}</div>
                    <div class="metric-label">Overall Score</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">{{ report.overview.test_coverage }}</div>
                    <div class="metric-label">Test Coverage</div>
                </div>
            </div>
        </section>
        {% endif %}

        <!-- Key Findings -->
        {% if report.key_findings %}
        <section class="section">
            <h2 class="section-title">Key Findings</h2>
            {% for finding in report.key_findings %}
            <div class="finding-item">
                <p>{{ finding }}</p>
            </div>
            {% endfor %}
        </section>
        {% endif %}

        <!-- Recommendations -->
        {% if report.recommendations %}
        <section class="section">
            <h2 class="section-title">Recommendations</h2>
            {% for recommendation in report.recommendations %}
            <div class="recommendation-item">
                <p>{{ recommendation }}</p>
            </div>
            {% endfor %}
        </section>
        {% endif %}

        <!-- Detailed Metrics -->
        {% if report.metrics %}
        <section class="section">
            <h2 class="section-title">Detailed Metrics</h2>
            <table class="metrics-table">
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Value</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Total Agents</td>
                        <td>{{ report.metrics.total_agents }}</td>
                        <td>
                            <span class="score-badge score-good">ACTIVE</span>
                        </td>
                    </tr>
                    <tr>
                        <td>Timeline Events</td>
                        <td>{{ report.metrics.timeline_events }}</td>
                        <td>
                            <span class="score-badge score-excellent">LOGGED</span>
                        </td>
                    </tr>
                    <tr>
                        <td>Duration</td>
                        <td>{{ report.metrics.duration_minutes }} minutes</td>
                        <td>
                            {% if report.metrics.duration_minutes < 60 %}
                            <span class="score-badge score-excellent">FAST</span>
                            {% elif report.metrics.duration_minutes < 180 %}
                            <span class="score-badge score-good">NORMAL</span>
                            {% else %}
                            <span class="score-badge score-fair">SLOW</span>
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>Overall Score</td>
                        <td>{{ report.metrics.overall_score }}%</td>
                        <td>
                            {% if report.metrics.overall_score >= 90 %}
                            <span class="score-badge score-excellent">EXCELLENT</span>
                            {% elif report.metrics.overall_score >= 70 %}
                            <span class="score-badge score-good">GOOD</span>
                            {% elif report.metrics.overall_score >= 50 %}
                            <span class="score-badge score-fair">FAIR</span>
                            {% else %}
                            <span class="score-badge score-poor">POOR</span>
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>Test Coverage</td>
                        <td>{{ report.metrics.test_coverage }}%</td>
                        <td>
                            {% if report.metrics.test_coverage >= 90 %}
                            <span class="score-badge score-excellent">COMPLETE</span>
                            {% elif report.metrics.test_coverage >= 70 %}
                            <span class="score-badge score-good">ADEQUATE</span>
                            {% else %}
                            <span class="score-badge score-fair">LIMITED</span>
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>Errors</td>
                        <td>{{ report.metrics.error_count }}</td>
                        <td>
                            {% if report.metrics.error_count == 0 %}
                            <span class="score-badge score-excellent">NONE</span>
                            {% elif report.metrics.error_count <= 5 %}
                            <span class="score-badge score-fair">SOME</span>
                            {% else %}
                            <span class="score-badge score-poor">MANY</span>
                            {% endif %}
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>
        {% endif %}

        <!-- Agent Scores -->
        {% if report.charts and report.charts.agent_scores %}
        <section class="section">
            <h2 class="section-title">Agent Performance</h2>
            <div class="chart-container">
                <canvas id="agentScoresChart" width="400" height="200"></canvas>
            </div>
            
            <table class="metrics-table">
                <thead>
                    <tr>
                        <th>Agent</th>
                        <th>Score</th>
                        <th>Performance</th>
                    </tr>
                </thead>
                <tbody>
                    {% for agent, score in report.charts.agent_scores.items() %}
                    <tr>
                        <td>{{ agent }}</td>
                        <td>{{ score }}%</td>
                        <td>
                            {% if score >= 90 %}
                            <span class="score-badge score-excellent">EXCELLENT</span>
                            {% elif score >= 70 %}
                            <span class="score-badge score-good">GOOD</span>
                            {% elif score >= 50 %}
                            <span class="score-badge score-fair">FAIR</span>
                            {% else %}
                            <span class="score-badge score-poor">POOR</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>
        {% endif %}

        <!-- Error Distribution -->
        {% if report.charts and report.charts.error_distribution %}
        <section class="section">
            <h2 class="section-title">Issue Distribution</h2>
            <div class="chart-container">
                <canvas id="errorDistChart" width="400" height="200"></canvas>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="error-item">
                        <strong>Errors:</strong> {{ report.charts.error_distribution.errors }}
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="warning-item">
                        <strong>Warnings:</strong> {{ report.charts.error_distribution.warnings }}
                    </div>
                </div>
            </div>
        </section>
        {% endif %}

        <!-- Report Footer -->
        <footer class="section text-center">
            <hr>
            <p class="text-muted">
                Generated by Agentic QA Team System on {{ report.generated_at }}<br>
                Report ID: {{ report.report_id | default('N/A') }}
            </p>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        // Agent Scores Chart
        {% if report.charts and report.charts.agent_scores %}
        const agentScoresCtx = document.getElementById('agentScoresChart').getContext('2d');
        new Chart(agentScoresCtx, {
            type: 'bar',
            data: {
                labels: {{ report.charts.agent_scores.keys() | list | tojson }},
                datasets: [{
                    label: 'Agent Scores (%)',
                    data: {{ report.charts.agent_scores.values() | list | tojson }},
                    backgroundColor: [
                        '#007bff', '#28a745', '#ffc107', '#17a2b8',
                        '#6f42c1', '#fd7e14', '#20c997', '#e83e8c',
                        '#6c757d', '#dc3545'
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        title: {
                            display: true,
                            text: 'Score (%)'
                        }
                    }
                }
            }
        });
        {% endif %}

        // Error Distribution Chart
        {% if report.charts and report.charts.error_distribution %}
        const errorDistCtx = document.getElementById('errorDistChart').getContext('2d');
        new Chart(errorDistCtx, {
            type: 'doughnut',
            data: {
                labels: ['Errors', 'Warnings'],
                datasets: [{
                    data: [
                        {{ report.charts.error_distribution.errors }},
                        {{ report.charts.error_distribution.warnings }}
                    ],
                    backgroundColor: ['#dc3545', '#ffc107'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });
        {% endif %}
    </script>
</body>
</html>